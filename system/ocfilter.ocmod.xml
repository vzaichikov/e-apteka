<?xml version="1.0" encoding="utf-8"?>
<modification>
	<name>OCFilter Modification</name>
	<code>ocfilter-product-filter</code>
	<version>4.7.5.0.3</version>
	<author>Aleksandr S.</author>
	<link>https://ocfilter.com</link>
	
	<!-- CONTROLLER -->
	<file path="admin/controller/catalog/product.php">
		<operation>
			<search><![CDATA[function getForm() {]]></search>
			<add position="after"><![CDATA[
				// OCFilter start
				$this->document->addStyle('view/stylesheet/ocfilter/ocfilter.css');
				$this->document->addScript('view/javascript/ocfilter/ocfilter.js');
				// OCFilter end
			]]></add>
		</operation>
		<operation>
			<search><![CDATA[$this->language->get('tab_general');]]></search>
			<add position="after"><![CDATA[
				// OCFilter start
				$data['tab_ocfilter'] = $this->language->get('tab_ocfilter');
				$data['entry_values'] = $this->language->get('entry_values');
				$data['ocfilter_select_category'] = $this->language->get('ocfilter_select_category');
				// OCFilter end
			]]></add>
		</operation>
	</file>
	
	<file path="admin/controller/common/column_left.php">
		<operation>
			<search><![CDATA[if ($this->user->hasPermission('access', 'catalog/filter')) {]]></search>
			<add position="before"><![CDATA[
				// OCFilter start
				$ocfilter = array();
				
				if ($this->user->hasPermission('access', 'catalog/ocfilter')) {
				$ocfilter[] = array(
				'name'     => $this->language->get('text_ocfilter_option'),
				'href'     => $this->url->link('catalog/ocfilter', 'token=' . $this->session->data['token'], true),
				'children' => array()
				);
				}
				
				if ($this->user->hasPermission('access', 'catalog/ocfilter_page')) {
				$ocfilter[] = array(
				'name'	   => $this->language->get('text_ocfilter_page'),
				'href'     => $this->url->link('catalog/ocfilter_page', 'token=' . $this->session->data['token'], true),
				'children' => array()
				);
				}
				
				if ($this->user->hasPermission('access', 'extension/module/ocfilter')) {
				$ocfilter[] = array(
				'name'	   => $this->language->get('text_ocfilter_setting'),
				'href'     => $this->url->link('extension/module/ocfilter', 'token=' . $this->session->data['token'], true),
				'children' => array()
				);
				}
				
				if ($ocfilter) {
				$catalog[] = array(
				'name'	   => $this->language->get('text_ocfilter'),
				'href'     => '',
				'children' => $ocfilter
				);
				}
				// OCFilter end
			]]></add>
		</operation>
	</file><!-- /admin/controller/common/column_left.php -->
	<!-- /CONTROLLER -->
	
	<!-- LANGUAGE -->
	<file path="admin/language/{en}*/catalog/product.php">
		<operation>
			<search><![CDATA[$_['text_success']]]></search>
			<add position="before"><![CDATA[
				// OCFilter start
				$_['entry_values']          		= 'Add the values ​​for this option.';
				$_['tab_ocfilter']          		= 'OCFilter Options';
				$_['ocfilter_select_category'] 	= 'To start, select a category for this product.';
				// OCFilter end
			]]></add>
		</operation>
	</file>
	
	<file path="admin/language/{ru}*/catalog/product.php">
		<operation>
			<search><![CDATA[$_['text_success']]]></search>
			<add position="before"><![CDATA[
				// OCFilter start
				$_['entry_values']          		= 'Добавьте значения для этой опции.';
				$_['tab_ocfilter']          		= 'Опции фильтра';
				$_['ocfilter_select_category'] 	= 'Для начала, выберите категории для этого товара.';
				// OCFilter end
			]]></add>
		</operation>
	</file>
	
	<file path="admin/language/{en}*/common/column_left.php">
		<operation>
			<search><![CDATA[$_['text_option']]]></search>
			<add position="before"><![CDATA[
				// OCFilter start
				$_['text_ocfilter']                    = 'Фильтр Eapteka';
				$_['text_ocfilter_option']             = 'Filters';
				$_['text_ocfilter_page']               = 'SEO Pages';
				$_['text_ocfilter_setting']            = 'Settings';
				// OCFilter end
			]]></add>
		</operation>
	</file>
	
	<file path="admin/language/{ru}*/common/column_left.php">
		<operation>
			<search><![CDATA[$_['text_option']]]></search>
			<add position="before"><![CDATA[
				// OCFilter start
				$_['text_ocfilter']                    = 'Фильтр Eapteka';
				$_['text_ocfilter_option']             = 'Фильтры';
				$_['text_ocfilter_page']               = 'Страницы';
				$_['text_ocfilter_setting']            = 'Настройки';
				// OCFilter end
			]]></add>
		</operation>
	</file>
	
	<!-- /LANGUAGE -->
	
	<!-- MODEL -->
	<file path="admin/model/catalog/product.php">
		<operation>
			<search><![CDATA[if (isset($data['product_layout'])) {]]></search>
			<add position="before"><![CDATA[
				// OCFilter start
				$this->db->query("DELETE FROM " . DB_PREFIX . "ocfilter_option_value_to_product WHERE product_id = '" . (int)$product_id . "'");
				
				if (isset($data['ocfilter_product_option'])) {
				foreach ($data['ocfilter_product_option'] as $option_id => $values) {
				foreach ($values['values'] as $value_id => $value) {
				if (isset($value['selected'])) {
				$this->db->query("INSERT IGNORE INTO " . DB_PREFIX . "ocfilter_option_value_to_product SET product_id = '" . (int)$product_id . "', option_id = '" . (int)$option_id . "', value_id = '" . (string)$value_id . "', slide_value_min = '" . (isset($value['slide_value_min']) ? (float)$value['slide_value_min'] : 0) . "', slide_value_max = '" . (isset($value['slide_value_max']) ? (float)$value['slide_value_max'] : 0) . "'");
				}
				}
				}
				}
				// OCFilter end
			]]></add>
		</operation>
		<operation>
			<search><![CDATA[$data['product_attribute'] = $this->getProductAttributes($product_id);]]></search>
			<add position="after"><![CDATA[
				// OCFilter start
				$this->load->model('catalog/ocfilter');
				
				$data['ocfilter_product_option'] = $this->model_catalog_ocfilter->getProductOCFilterValues($product_id);
				// OCFilter end
			]]></add>
		</operation>
		<operation>
			<search><![CDATA[$this->db->query("DELETE FROM " . DB_PREFIX . "product WHERE product_id = '" . (int)$product_id . "'");]]></search>
			<add position="after"><![CDATA[
				// OCFilter start
				$this->db->query("DELETE FROM " . DB_PREFIX . "ocfilter_option_value_to_product WHERE product_id = '" . (int)$product_id . "'");
				// OCFilter end
			]]></add>
		</operation>
	</file><!-- /admin/model/catalog/product.php -->
	
	<!-- /MODEL -->
	
	<!-- VIEW -->
	<file path="admin/view/template/catalog/product_form.tpl">
		<operation>
			<search index="0"><![CDATA[<?php echo $footer; ?>]]></search>
			<add position="before"><![CDATA[
				<!-- OCFilter start -->
				<script type="text/javascript"><!--
				ocfilter.php = {
				text_select: '<?php echo $text_select; ?>',
				ocfilter_select_category: '<?php echo $ocfilter_select_category; ?>',
				entry_values: '<?php echo $entry_values; ?>',
				tab_ocfilter: '<?php echo $tab_ocfilter; ?>'
				};
				
				ocfilter.php.languages = [];
				
				<?php foreach ($languages as $language) { ?>
					ocfilter.php.languages.push({
					'language_id': <?php echo $language['language_id']; ?>,
					'name': '<?php echo $language['name']; ?>',
					'image': '<?php echo $language['image']; ?>'
					});
				<?php } ?>
				//--></script>
				<!-- OCFilter end -->
			]]></add>
		</operation>
	</file><!-- /admin/view/template/catalog/product_form.tpl -->
	<!-- /VIEW -->
	
	<!-- CATALOG -->
	
	<!-- >= 2.2 -->
	<file path="catalog/controller/startup/maintenance.php">
		<operation>
			<search><![CDATA[index() {]]></search>
			<add position="after"><![CDATA[
				// OCFilter start
				$this->load->controller('extension/module/ocfilter/initialise');
				// OCFilter end
			]]></add>
		</operation>
	</file>
	
	<file path="catalog/controller/startup/seo_url.php">
		<operation>
			<search><![CDATA[$this->url->addRewrite($this);]]></search>
			<add position="after"><![CDATA[
				// OCFilter start
				if (!is_null($this->registry->get('ocfilter'))) {
				$this->url->addRewrite($this->registry->get('ocfilter'));
				}
				// OCFilter end
			]]></add>
		</operation>
	</file>
	
	<file path="catalog/controller/{common,startup}/seo_pro.php">
		<operation>
			<search><![CDATA[$this->url->addRewrite($this);]]></search>
			<add position="after"><![CDATA[
				// OCFilter start
				if (!is_null($this->registry->get('ocfilter'))) {
				$this->url->addRewrite($this->registry->get('ocfilter'));
				}
				// OCFilter end
			]]></add>
		</operation>
	</file>
	
	<file path="catalog/controller/{common,startup}/seo_pro.php">
		<operation>
			<search><![CDATA[$this->url->addRewrite($this, $lang_data);]]></search>
			<add position="after"><![CDATA[
				// OCFilter start
				if (!is_null($this->registry->get('ocfilter'))) {
				$this->url->addRewrite($this->registry->get('ocfilter'));
				}
				// OCFilter end
			]]></add>
		</operation>
	</file>
	
	
</modification>